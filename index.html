<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Shindig Grid Prototype</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="static/libs/three.js"></script>
		<script src="static/libs/dat.gui.min.js"></script>
		<script src="static/src/tools.js"></script>
		<script src="static/src/row.js"></script>
		<script>

			/***********************
				3D SET UP 
			************************/

			var scene;
			var camera;
			var renderer;

			var plane_W = 15;
			var itemPadding = 20;
			var rowPadding = plane_W;
			var cameraZpos = 40;
			var cameraYpos = 30;
			var gridRowsArray;
			var rowZ = [0];

			function init() {

				scene = new THREE.Scene();

				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.5, 1000 );
				camera.position.z = cameraZpos;
				camera.position.y = cameraYpos
				camera.rotation.x = -0.05;

				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );


				/***********************
					GRID SET UP 
				************************/
				var planeGeo 	= new THREE.PlaneGeometry( plane_W, (plane_W * 0.75), 1);
				var imgTexture 	= new THREE.TextureLoader().load("assets/img/girl_blonde3x4.jpg");
				var imgMat 		= new THREE.MeshBasicMaterial({color: 0xffffff, map:imgTexture});
				var plane 		= new THREE.Mesh(planeGeo, imgMat);
				var participants = 14;
				var participantArray = [];

				var even = 4;
				var odd = (even - 1);
				var offset = plane_W/2;

				setRowSpacing( 4, plane_W )
					
				gridRowsArray = [
					row = new Row(4, itemPadding, plane_W, rowZ[1]),
					row = new Row(3, itemPadding, plane_W, rowZ[2]),
					row = new Row(4, itemPadding, plane_W, rowZ[3]),
					row = new Row(3, itemPadding, plane_W, rowZ[4])
				];


				console.log( "gridRowsArray");
				for ( i in gridRowsArray) {
					var row = gridRowsArray[i];
					console.log( row );
				}
				

				/********************************************
					 - populate grid with Avatars 
					 - set Avatar coords to match coords of slots in grid 
				***********************************************/ 

				for (i = 0; i < gridRowsArray.length; i++ ) {

					var row = gridRowsArray[i];

					for (k = 0; k < row.length; k++ ) {
						row[k].avatar = new THREE.Mesh(planeGeo, imgMat); 
						row[k].avatar.position.x = row[k].x;
						row[k].avatar.position.z = row[k].z;
						scene.add( row[k].avatar )
					}
				}


				document.body.appendChild( renderer.domElement );

				render();

				function render() {
					requestAnimationFrame( render );
					renderer.render(scene, camera);
				};

			
			};

			function setRowSpacing( numberOfRows, spacing ) {
				for ( var i = 0; i < numberOfRows; i++ ) {
					var rowNum = i+1;
					rowZ[rowNum] = (spacing * rowNum) * -1;
				}
			}


			window.onload = init;

			function onResize() {
		        camera.aspect = window.innerWidth / window.innerHeight;

		        // adjust the FOV
    			camera.fov = ( 360 / Math.PI ) * Math.atan( tanFOV * ( window.innerHeight / windowHeight ) );


		        camera.updateProjectionMatrix();
		        renderer.setSize(window.innerWidth, window.innerHeight);
		    }

		    window.addEventListener('resize', onResize, false);


		    /********************** 
					GUI 
		    ***********************/

		    function updateGrid() {
		    	console.log( "updateGrid");
		    	setRowSpacing( 4, params.paddingZ );

		    	for ( var i = 0; i < gridRowsArray.length; i++) {
 				
		    		var row = gridRowsArray[i];
		    		row.padding = params.paddingX;
		    		row.itemWidth = plane_W;
		    		row.zPos = rowZ[i+1];
		    		row.update()
		    	}
		    	camera.position.z = params.cameraZ;
		    }


		    var params = {
		    	paddingX: itemPadding,
		    	paddingZ: rowPadding,
		    	cameraZ: cameraZpos
		    }

		    var gui = new dat.GUI()
		    gui.add( params, "paddingX").min(0).max(30).step(1).onChange( updateGrid );
		    gui.add( params, "paddingZ").min(plane_W * 0.75).max(plane_W * 1.25).onChange( updateGrid );
		    gui.add( params, "cameraZ").min(cameraZpos * 0.85).max(cameraZpos *1.25).onChange( updateGrid );




		</script>
	</body>
</html>